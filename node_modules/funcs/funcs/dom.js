;(function() {
    "use strict";
    // функции для работы с DOM

    // получаем scroll документа
    function getScroll() {
	  var   x = 0,
			y = 0,
			html = document.getElementsByTagName('html')[0],
			body = document.body;

		if ( window.pageXOffset != undefined ) {
			y = pageYOffset;
			x = pageXOffset;
		} else {
			y = (html.scrollTop||body&&body.scrollTop||0) - html.clientTop;
			x = (html.scrollLeft||body&&body.scrollLeft||0) - html.clientLeft;
		}

		return {
				top : y,
				left : x
			};
	}
	f.getScroll = getScroll;

    // на входе может быть строка, dom-element, jquery-объект
	// иначе ошибка
	// на выходе jquery-объект
	f.checkElem = function($el) {
		if ( f.isString($el) || $el instanceof Element ) {
			$el = $($el);
		} else
		if ( !($el instanceof $) ) {
			throw new Error("bad elem", $el);
		}
		return $el;
	};

    // проверяем находится ли $el внутри $wrapper
	f.checkElemIn = function($el, $wrapper) {
        $el = f.checkElem($el);
        $wrapper = f.checkElem($wrapper);
        var el = $el.get(0);
        var wrapper = $wrapper.get(0);

        if ( wrapper == el ) {
            return true;
        }

        var body = document.body;
        if ( wrapper != body && el == body ) {
            return false;
        }

        var parent = el.parentNode;
        while ( parent && parent != body && parent != wrapper  ) {
            parent = parent.parentNode;
        }

        return parent == wrapper;
    };

    // определяем размеры окна
    function gwh(doc){
		doc = doc || document;
		var elem  = doc.compatMode == 'CSS1Compat' ? doc.documentElement : doc.body;
		return [elem.clientWidth, elem.clientHeight];
	}

	f.getWindowSize = function() {
		var wh = gwh();
		return {
			width: wh[0],
			height: wh[1]
		};
	};

    // удобный метод для "классов", который находит $box в параметрах
    f.initBox = function(params) {
		if ( !f.isObject(params) ) {
			params = {};
		}

		var $box, box;
		// { box: "selector" }
		if ( f.isString(params.box) ) {
			$box = $(params.box);
			box = $box.get(0);
		} else
		// { $box: "selector" }
		if ( f.isString(params.$box) ) {
			$box = $(params.$box);
			box = $box.get(0);
		} else
		// { box: jQueryObject }
		if ( params.box instanceof $ ) {
			$box = params.box;
			box = $box.get(0);
		} else
		// { $box: jQueryObject }
		if ( params.$box instanceof $ ) {
			$box = params.$box;
			box = $box.get(0);
		} else
		// { $box: Element or str }
		if ( params.$box ) {
			$box = $(params.$box);
			box = $box.get(0);
		} else
		// { box: Element or str }
		if ( params.box ) {
			$box = $(params.box);
			box = $box.get(0);
		}

		if ( !(box instanceof Element) ) {
			throw new Error("Box is not are DOMElement");
		}

		this.box = box;
		this.$box = $box;
	};

    // достаем координаты из события mobile/desktop
    f.getMousePoint = function(e) {
        return f.getTouchPoint(e);
    };

    f.getTouchPoint = function(e) {
        if ( e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length > 0 ) {
            return {
                x: e.originalEvent.touches[0].pageX,
                y: e.originalEvent.touches[0].pageY
            };
        } else {
            return {
                x: e.pageX,
                y: e.pageY
            };
        }
    };
	
    f.downloadFile = function(sUrl) {
     
        //Creating new link node.
        var link = document.createElement('a');
        link.href = sUrl;
        
        if (link.download !== undefined){
            //Set HTML5 download attribute. This will prevent file from opening if supported.
            var fileName = sUrl.substring(sUrl.lastIndexOf('/') + 1, sUrl.length);
            link.download = fileName;
        }
    
        //Dispatching click event.
        if (document.createEvent) {
            var e = document.createEvent('MouseEvents');
            if ( f.aboutBrow().brow == "Internet Explorer" ) {
                link.target = "_blank";
                document.body.appendChild(link);
                e.initEvent('click' ,true ,true);
                link.dispatchEvent(e);
                link.outerHTML = "";
            } else {
                e.initEvent('click' ,true ,true);
                link.dispatchEvent(e);
            }
            
            return true;
        } else {
            window.open(sUrl, "_blank");
        }
    };

})();
