;(function() {
    "use strict";

    // результат - объект, разница между двумя исходными объектами
    // данные в результате будут взяты из объекта b
    // сравнение не строгое
    f.deepChangedData = function(a, b) {

        if ( !f.isObject(a) ) {
            a = {};
        }

        if ( !f.isObject(b) ) {
            b = {};
        }

        function diff(a, b) {
            var out = {};

            for (var key in b) {
                if ( !f.isObject(b[key]) ) {
                    if ( a[key] != b[key] ) {
                        out[key] = f.deepClone(b[key]);
                    }
                } else {
                    if ( f.isObject(a[key]) ) {
                        out[key] = diff(a[key], b[key]);
                        if ( JSON.stringify(out[key]) == "{}" ) {
                            delete out[key];
                        }
                    } else {
                        out[key] = f.deepClone(b[key]);
                    }
                }
            }

            return out;
        }

        return diff(a, b);
    };

})();
